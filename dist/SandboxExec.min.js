Object.getPrototypeOf(async function(){}).constructor,Object.getPrototypeOf(function*(){}).constructor,Object.getPrototypeOf(async function*(){}).constructor;const t=function(t){for(const e in t)this[e]=t[e]};class e{constructor(t){this.ref={str:""},t instanceof e?(this.ref=t.ref,this.start=t.start,this.end=t.end):(this.ref.str=t,this.start=0,this.end=t.length)}substring(t,o){if(!this.length)return this;(t=this.start+t)<0&&(t=0),t>this.end&&(t=this.end),(o=void 0===o?this.end:this.start+o)<0&&(o=0),o>this.end&&(o=this.end);const n=new e(this);return n.start=t,n.end=o,n}get length(){const t=this.end-this.start;return t<0?0:t}char(t){if(this.start!==this.end)return this.ref.str[this.start+t]}toString(){return this.ref.str.substring(this.start,this.end)}trimStart(){const t=/^\s+/.exec(this.toString()),o=new e(this);return t&&(o.start+=t[0].length),o}slice(t,e){return t<0&&(t=this.end-this.start+t),t<0&&(t=0),void 0===e&&(e=this.end-this.start),e<0&&(e=this.end-this.start+e),e<0&&(e=0),this.substring(t,e)}trim(){const t=this.trimStart(),e=/\s+$/.exec(t.toString());return e&&(t.end-=e[0].length),t}valueOf(){return this.toString()}}function o(t){const e=Object.assign({},t);for(const t in e)e[t]=!0;return e}const n=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","let","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"]);class r{constructor(t,e={},n){this.const={},this.let={},this.var={};const r=void 0!==n||null===t;this.parent=t,this.allVars=e,this.let=r?this.let:o(e),this.var=r?o(e):this.var,this.globals=null===t?o(e):{},this.functionThis=n}get(t){const e="this"===t,o=this.getWhereValScope(t,e);return o&&e?new c({this:o.functionThis},t,!0,!1,!0):o?new c(o.allVars,t,t in o.const,t in o.globals,!0):new c(void 0,t)}set(t,e){if("this"===t)throw new SyntaxError('"this" cannot be assigned');if(n.has(t))throw new SyntaxError("Unexepected token '"+t+"'");const o=this.get(t);if(void 0===o.context)throw new ReferenceError(`Variable '${t}' was not declared.`);if(null===o.context)throw new TypeError(`Cannot set properties of null, (setting '${t}')`);if(o.isConst)throw new TypeError(`Cannot assign to const variable '${t}'`);if(o.isGlobal)throw new s(`Cannot override global variable '${t}'`);return o.context[o.prop]=e,o}getWhereValScope(t,e=!1){return e?void 0!==this.functionThis?this:this.parent?.getWhereValScope(t,e)||null:t in this.allVars?this:this.parent?.getWhereValScope(t,e)||null}getWhereVarScope(t,e=!1){return t in this.allVars||null===this.parent||e||void 0!==this.functionThis?this:this.parent.getWhereVarScope(t,e)}declare(t,e,o=void 0,r=!1){if("this"===t)throw new SyntaxError('"this" cannot be declared');if(n.has(t))throw new SyntaxError("Unexepected token '"+t+"'");const i=this.getWhereVarScope(t,"var"!==e);if("var"===e){if(i.var[t])return i.allVars[t]=o,r?i.globals[t]=!0:delete i.globals[t],new c(i.allVars,t,!1,i.globals[t],!0);if(t in i.allVars)throw new SyntaxError(`Identifier '${t}' has already been declared`)}if(t in i.allVars)throw new SyntaxError(`Identifier '${t}' has already been declared`);return r&&(i.globals[t]=!0),i[e][t]=!0,i.allVars[t]=o,new c(this.allVars,t,"const"===e,r,!0)}}class i{}class s extends Error{}function a(t){return Array.isArray(t)&&"number"==typeof t[0]&&0!==t[0]&&88!==t[0]}class c{constructor(t,e,o=!1,n=!1,r=!1){this.context=t,this.prop=e,this.isConst=o,this.isGlobal=n,this.isVariable=r}get(t){const e=this.context;if(void 0===e)throw new ReferenceError(`${this.prop.toString()} is not defined`);if(null===e)throw new TypeError(`Cannot read properties of null, (reading '${this.prop.toString()}')`);return t.getSubscriptions.forEach(t=>t(e,this.prop.toString())),e[this.prop]}}function l(t,e){return Object.prototype.hasOwnProperty.call(t,e)}class p{constructor(t,e,o,n=!1,r=!1){this.auditReport=t,this.result=e,this.returned=o,this.breakLoop=n,this.continueLoop=r}}const d={};function u(t,e){const o={};return t.forEach((t,n)=>{t.startsWith("...")?o[t.substring(3)]=e.slice(n):o[t]=e[n]}),o}const f=new WeakSet;function h(t,e,o,n,i,a){if(n.ctx.options.forbidFunctionCreation)throw new s("Function creation is forbidden");let c;return c=void 0===a?(...s)=>{const a=u(t,s);return U(o,n,e,void 0===i?[]:[new r(i,a)]).result}:function(...s){const a=u(t,s);return U(o,n,e,void 0===i?[]:[new r(i,a,this)]).result},n.registerSandboxFunction(c),f.add(c),c}function v(t,e,o,n,i,a){if(n.ctx.options.forbidFunctionCreation)throw new s("Function creation is forbidden");if(!n.ctx.prototypeWhitelist?.has(Promise.prototype))throw new s("Async/await not permitted");let c;return c=void 0===a?async(...s)=>{const a=u(t,s);return(await j(o,n,e,void 0===i?[]:[new r(i,a)])).result}:async function(...s){const a=u(t,s);return(await j(o,n,e,void 0===i?[]:[new r(i,a,this)])).result},n.registerSandboxFunction(c),f.add(c),c}function w(t,e,o="assign"){if(void 0===t.context)throw new ReferenceError(`Cannot ${o} value to undefined.`);if("object"!=typeof t.context&&"function"!=typeof t.context)throw new SyntaxError(`Cannot ${o} value to a primitive.`);if(t.isConst)throw new TypeError("Assignment to constant variable.");if(t.isGlobal)throw new s(`Cannot ${o} property '${t.prop.toString()}' of a global object`);if(null===t.context)throw new TypeError("Cannot set properties of null");if("function"==typeof t.context[t.prop]&&!l(t.context,t.prop))throw new s(`Override prototype property '${t.prop.toString()}' not allowed`);"delete"===o?l(t.context,t.prop)&&(e.changeSubscriptions.get(t.context)?.forEach(e=>e({type:"delete",prop:t.prop.toString()})),e.changeSubscriptionsGlobal.get(t.context)?.forEach(e=>e({type:"delete",prop:t.prop.toString()}))):l(t.context,t.prop)?(e.setSubscriptions.get(t.context)?.get(t.prop.toString())?.forEach(t=>t({type:"replace"})),e.setSubscriptionsGlobal.get(t.context)?.get(t.prop.toString())?.forEach(t=>t({type:"replace"}))):(e.changeSubscriptions.get(t.context)?.forEach(e=>e({type:"create",prop:t.prop.toString()})),e.changeSubscriptionsGlobal.get(t.context)?.forEach(e=>e({type:"create",prop:t.prop.toString()})))}const g=new Set([[].push,[].pop,[].shift,[].unshift,[].splice,[].reverse,[].sort,[].copyWithin]);class y{constructor(t,e){this.key=t,this.val=e}}class b{constructor(t){this.item=t}}class x{constructor(t){this.item=t}}class S{constructor(t,e){this.t=t,this.f=e}}const m=/(\$\$)*(\$)?\${(\d+)}/g,E=new Map;function I(t,e){E.set(t,e)}function A(t,e){return t instanceof c?t.get(e):t!==d?t:void 0}function R(t,e,o,n,r,i,s){e===$?function(t,e,o,n,r,i){const s=[];for(let c=0;c<e.length;c++){let l;try{l=O(o=>$(t,e[c],n,r,o,i)).result}catch(t){return void o(t)}if(l instanceof p&&(l.returned||l.breakLoop||l.continueLoop))return void o(void 0,l);if(a(e[c])&&8===e[c][0])return void o(void 0,new p(r.ctx.auditReport,l,!0));s.push(l)}o(void 0,s)}(t,o,n,r,i,s):async function(t,e,o,n,r,i){const s=[];for(let c=0;c<e.length;c++){let l;try{let o;l=!0===(o=k(o=>C(t,e[c],n,r,o,i))).isInstant?o.instant:(await o.p).result}catch(t){return void o(t)}if(l instanceof p&&(l.returned||l.breakLoop||l.continueLoop))return void o(void 0,l);if(a(e[c])&&8===e[c][0])return void o(void 0,new p(r.ctx.auditReport,l,!0));s.push(l)}o(void 0,s)}(t,o,n,r,i,s).catch(n)}function k(t){let e,o=!1;const n=new Promise((n,r)=>{t((t,i)=>{t?r(t):(o=!0,e=i,n({result:i}))})});return{isInstant:o,instant:e,p:n}}function O(t){let e,o;if(t((t,n)=>{o=t,e=n}),o)throw o;return{result:e}}async function C(t,e,o,n,r,i){let s=r;const l=new Promise(t=>{s=(e,o)=>{r(e,o),t()}});if(!F(t,e,o,n,s,!0,i)&&a(e)){let r,a=e[0];try{let s;r=!0===(s=k(r=>C(t,e[1],o,n,r,i))).isInstant?s.instant:(await s.p).result}catch(t){return void s(t)}let l,p=r;try{p=r instanceof c?r.get(n):r}catch(t){return void s(t)}if(20===a||21===a){if(null==p)return void s(void 0,d);a=20===a?1:5}if(p===d){if(1===a||5===a)return void s(void 0,p);p=void 0}if(89===a&&null!=p)return void s(void 0,p);try{let r;l=!0===(r=k(r=>C(t,e[2],o,n,r,i))).isInstant?r.instant:(await r.p).result}catch(t){return void s(t)}let u=l;try{u=l instanceof c?l.get(n):l}catch(t){return void s(t)}if(u===d&&(u=void 0),E.has(a))try{E.get(a)?.(C,s,t,p,u,r,n,o,l,i)}catch(t){s(t)}else s(new SyntaxError("Unknown operator: "+a))}await l}function $(t,e,o,n,r,i){if(!F(t,e,o,n,r,!1,i)&&a(e)){let s,a=e[0];try{s=O(r=>$(t,e[1],o,n,r,i)).result}catch(t){return void r(t)}let l,p=s;try{p=s instanceof c?s.get(n):s}catch(t){return void r(t)}if(20===a||21===a){if(null==p)return void r(void 0,d);a=20===a?1:5}if(p===d){if(1===a||5===a)return void r(void 0,p);p=void 0}if(89===a&&null!=p)return void r(void 0,p);try{l=O(r=>$(t,e[2],o,n,r,i)).result}catch(t){return void r(t)}let u=l;try{u=l instanceof c?l.get(n):l}catch(t){return void r(t)}if(u===d&&(u=void 0),E.has(a))try{E.get(a)?.($,r,t,p,u,s,n,o,l,i)}catch(t){r(t)}else r(new SyntaxError("Unknown operator: "+a))}}I(1,(t,e,o,n,r,i,a,p)=>{if(null===n)throw new TypeError(`Cannot read properties of null (reading '${r?.toString()}')`);if(!["string","number","symbol"].includes(typeof r))try{r=`${r}`}catch(u){return void e(u)}if(void 0===n&&void 0===i&&"string"==typeof r){const t=p.get(r);t.context===a.ctx.sandboxGlobal&&a.ctx.options.audit&&a.ctx.auditReport?.globalsAccess.add(r);const o=t.context?t.context[t.prop]:void 0;if(o===globalThis)return void e(void 0,new c({[t.prop]:a.ctx.sandboxGlobal},t.prop,t.isConst,!1,t.isVariable));const n="function"==typeof o&&a.evals.get(o);return n?void e(void 0,new c({[t.prop]:n},t.prop,t.isConst,!0,t.isVariable)):void e(void 0,t)}if(void 0===n)throw new s(`Cannot read properties of undefined (reading '${r.toString()}')`);if(!function(t){return null!=t}(n))return void e(void 0,new c(void 0,r));const d="function"==typeof n||!l(n,r);if(a.ctx.options.audit&&d){let t=Object.getPrototypeOf(n);do{l(t,r)&&(a.ctx.auditReport&&!a.ctx.auditReport.prototypeAccess[t.constructor.name]&&(a.ctx.auditReport.prototypeAccess[t.constructor.name]=new Set),a.ctx.auditReport?.prototypeAccess[t.constructor.name].add(r))}while(t=Object.getPrototypeOf(t))}if(d){if("function"==typeof n&&l(n,r)){const t=a.ctx.prototypeWhitelist.get(n.prototype),o=a.ctx.options.prototypeReplacements.get(n);if(o)return void e(void 0,new c(o(n,!0),r));if(!t||t.size&&!t.has(r))throw new s(`Static method or property access not permitted: ${n.name}.${r.toString()}`)}let t=n;for(;t=Object.getPrototypeOf(t);)if(l(t,r)){const o=a.ctx.prototypeWhitelist.get(t),i=a.ctx.options.prototypeReplacements.get(t.constructor);if(i)return void e(void 0,new c(i(n,!1),r));if(o&&(!o.size||o.has(r)))break;throw new s(`Method or property access not permitted: ${t.constructor.name}.${r.toString()}`)}}const u="function"==typeof n[r]&&a.evals.get(n[r]);if(u)return void e(void 0,new c({[r]:u},r,!1,!0,!1));if(n[r]===globalThis)return void e(void 0,new c({[r]:a.ctx.sandboxGlobal},r,!1,!1,!1));const h=i.isGlobal||"function"==typeof n&&!f.has(n)||a.ctx.globalsWhitelist.has(n);e(void 0,new c(n,r,!1,h,!1))}),I(5,(t,e,o,n,r,i,a)=>{if(a.ctx.options.forbidFunctionCalls)throw new s("Function invocations are not allowed");if("function"!=typeof n)throw new TypeError(`${"symbol"==typeof i.prop?"Symbol":i.prop} is not a function`);const c=r.map(t=>t instanceof x?[...t.item]:[t]).flat().map(t=>A(t,a));if("function"==typeof i)return void e(void 0,i(...c));if(i.context[i.prop]===JSON.stringify&&a.getSubscriptions.size){const t=new Set,e=o=>{if(o&&"object"==typeof o&&!t.has(o)){t.add(o);for(const t of Object.keys(o))a.getSubscriptions.forEach(e=>e(o,t)),e(o[t])}};e(c[0])}if(i.context instanceof Array&&g.has(i.context[i.prop])&&(a.changeSubscriptions.get(i.context)||a.changeSubscriptionsGlobal.get(i.context))){let t,e=!1;if("push"===i.prop)t={type:"push",added:c},e=!!c.length;else if("pop"===i.prop)t={type:"pop",removed:i.context.slice(-1)},e=!!t.removed.length;else if("shift"===i.prop)t={type:"shift",removed:i.context.slice(0,1)},e=!!t.removed.length;else if("unshift"===i.prop)t={type:"unshift",added:c},e=!!c.length;else if("splice"===i.prop)t={type:"splice",startIndex:c[0],deleteCount:void 0===c[1]?i.context.length:c[1],added:c.slice(2),removed:i.context.slice(c[0],void 0===c[1]?void 0:c[0]+c[1])},e=!!t.added.length||!!t.removed.length;else if("reverse"===i.prop||"sort"===i.prop)t={type:i.prop},e=!!i.context.length;else if("copyWithin"===i.prop){const o=void 0===c[2]?i.context.length-c[1]:Math.min(i.context.length,c[2]-c[1]);t={type:"copyWithin",startIndex:c[0],endIndex:c[0]+o,added:i.context.slice(c[1],c[1]+o),removed:i.context.slice(c[0],c[0]+o)},e=!!t.added.length||!!t.removed.length}e&&(a.changeSubscriptions.get(i.context)?.forEach(e=>e(t)),a.changeSubscriptionsGlobal.get(i.context)?.forEach(e=>e(t)))}i.get(a);let l=i.context[i.prop](...c);"function"==typeof l&&(l=a.evals.get(l)||l),l===globalThis&&(l=a.ctx.sandboxGlobal),e(void 0,l)}),I(22,(t,e,o,n,r)=>{let i={};for(const t of r)t.key instanceof b?i={...i,...t.key.item}:i[t.key]=t.val;e(void 0,i)}),I(6,(t,e,o,n,r)=>e(void 0,new y(n,r))),I(12,(t,e,o,n,r,i,s)=>{e(void 0,r.map(t=>t instanceof x?[...t.item]:[t]).flat().map(t=>A(t,s)))}),I(23,(t,e,o,n,r)=>e(void 0,r)),I(35,(t,e,o,n,r)=>{switch(r){case"true":return e(void 0,!0);case"false":return e(void 0,!1);case"null":return e(void 0,null);case"undefined":return e(void 0,void 0);case"NaN":return e(void 0,NaN);case"Infinity":return e(void 0,1/0)}e(new Error("Unknown symbol: "+r))}),I(7,(t,e,o,n,r)=>e(void 0,Number(r.replace(/_/g,"")))),I(83,(t,e,o,n,r)=>e(void 0,BigInt(r.replace(/_/g,"")))),I(2,(t,e,o,n,r,i,s)=>e(void 0,s.constants.strings[parseInt(r)])),I(85,(t,e,o,n,r,i,a)=>{const c=a.constants.regexes[parseInt(r)];if(!a.ctx.globalsWhitelist.has(RegExp))throw new s("Regex not permitted");e(void 0,new RegExp(c.regex,c.flags))}),I(84,(t,e,o,n,r,i,s,a)=>{const c=s.constants.literals[parseInt(r)],[,l,p]=c,d=[];let u;const f=[];for(;u=m.exec(l);)u[2]||(d.push(p[parseInt(u[3],10)]),f.push(u[3]));t(o,d,a,s,(t,o)=>{const n={};if(t)e(t);else{for(const t of Object.keys(o)){const e=f[t];n[e]=o[t]}e(void 0,l.replace(/(\\\\)*(\\)?\${(\d+)}/g,(t,e,o,r)=>{if(o)return t;return(e||"")+`${A(n[r],s)}`}))}})}),I(18,(t,e,o,n,r)=>{e(void 0,new x(r))}),I(17,(t,e,o,n,r)=>{e(void 0,new b(r))}),I(24,(t,e,o,n,r)=>e(void 0,!r)),I(64,(t,e,o,n,r)=>e(void 0,~r)),I(25,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,++i.context[i.prop])}),I(26,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]++)}),I(27,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,--i.context[i.prop])}),I(28,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]--)}),I(9,(t,e,o,n,r,i,s,a,c)=>{if(w(i,s),i.isGlobal=c?.isGlobal||!1,i.isVariable){const t=a.getWhereValScope(i.prop);if(null===t)throw new ReferenceError(`Cannot assign to undeclared variable '${i.prop}'`);i.isGlobal?t.globals[i.prop]=!0:delete t.globals[i.prop]}e(void 0,i.context[i.prop]=r)}),I(66,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]+=r)}),I(65,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]-=r)}),I(67,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]/=r)}),I(69,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]*=r)}),I(68,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]**=r)}),I(70,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]%=r)}),I(71,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]^=r)}),I(72,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]&=r)}),I(73,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]|=r)}),I(76,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]<<=r)}),I(75,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]>>=r)}),I(74,(t,e,o,n,r,i,s)=>{w(i,s),e(void 0,i.context[i.prop]>>>=r)}),I(57,(t,e,o,n,r)=>e(void 0,n>r)),I(56,(t,e,o,n,r)=>e(void 0,n<r)),I(55,(t,e,o,n,r)=>e(void 0,n>=r)),I(54,(t,e,o,n,r)=>e(void 0,n<=r)),I(52,(t,e,o,n,r)=>e(void 0,n==r)),I(32,(t,e,o,n,r)=>e(void 0,n===r)),I(53,(t,e,o,n,r)=>e(void 0,n!=r)),I(31,(t,e,o,n,r)=>e(void 0,n!==r)),I(29,(t,e,o,n,r)=>e(void 0,n&&r)),I(30,(t,e,o,n,r)=>e(void 0,n||r)),I(89,(t,e,o,n,r)=>e(void 0,n??r)),I(77,(t,e,o,n,r)=>e(void 0,n&r)),I(78,(t,e,o,n,r)=>e(void 0,n|r)),I(33,(t,e,o,n,r)=>e(void 0,n+r)),I(47,(t,e,o,n,r)=>e(void 0,n-r)),I(59,(t,e,o,n,r)=>e(void 0,+r)),I(58,(t,e,o,n,r)=>e(void 0,-r)),I(48,(t,e,o,n,r)=>e(void 0,n/r)),I(49,(t,e,o,n,r)=>e(void 0,n**r)),I(79,(t,e,o,n,r)=>e(void 0,n^r)),I(50,(t,e,o,n,r)=>e(void 0,n*r)),I(51,(t,e,o,n,r)=>e(void 0,n%r)),I(80,(t,e,o,n,r)=>e(void 0,n<<r)),I(81,(t,e,o,n,r)=>e(void 0,n>>r)),I(82,(t,e,o,n,r)=>e(void 0,n>>>r)),I(60,(t,e,o,n,r,i,s,a)=>{t(o,r,a,s,(t,o)=>{e(void 0,typeof A(o,s))})}),I(62,(t,e,o,n,r)=>e(void 0,n instanceof r)),I(63,(t,e,o,n,r)=>e(void 0,n in r)),I(61,(t,e,o,n,r,i,s,a,l)=>{l instanceof c?(w(l,s,"delete"),l.isVariable?e(void 0,!1):e(void 0,delete l.context?.[l.prop])):e(void 0,!0)}),I(8,(t,e,o,n,r)=>e(void 0,r)),I(34,(t,e,o,n,r,i,s,a,c)=>{e(void 0,a.declare(n,"var",r,c?.isGlobal||!1))}),I(3,(t,e,o,n,r,i,s,a,c)=>{e(void 0,a.declare(n,"let",r,c?.isGlobal||!1))}),I(4,(t,e,o,n,r,i,s,a,c)=>{e(void 0,a.declare(n,"const",r,c?.isGlobal||!1))}),I(11,(t,o,n,r,i,a,c,l)=>{if(r=[...r],"string"==typeof a[2]||a[2]instanceof e){if(!c.allowJit||!c.evalContext)throw new s("Unevaluated code detected, JIT not allowed");a[2]=i=c.evalContext.lispifyFunction(new e(a[2]),c.constants)}r.shift()?o(void 0,v(r,i,n,c,l)):o(void 0,h(r,i,n,c,l))}),I(37,(t,o,n,r,i,a,c,l)=>{if("string"==typeof a[2]||a[2]instanceof e){if(!c.allowJit||!c.evalContext)throw new s("Unevaluated code detected, JIT not allowed");a[2]=i=c.evalContext.lispifyFunction(new e(a[2]),c.constants)}const p=r.shift(),d=r.shift();let u;u=88===p?v(r,i,n,c,l,d):h(r,i,n,c,l,d),d&&l.declare(d,"var",u),o(void 0,u)}),I(10,(t,o,n,i,a,c,l,p)=>{if("string"==typeof c[2]||c[2]instanceof e){if(!l.allowJit||!l.evalContext)throw new s("Unevaluated code detected, JIT not allowed");c[2]=a=l.evalContext.lispifyFunction(new e(c[2]),l.constants)}const d=i.shift(),u=i.shift();let f;u&&(p=new r(p,{})),f=88===d?v(i,a,n,l,p,u):h(i,a,n,l,p,u),u&&p.declare(u,"let",f),o(void 0,f)}),I(38,(t,e,o,n,i,s,a,c)=>{const[l,d,u,f,h,v,w]=n;let g=!0;const y=new r(c,{}),b={$$obj:void 0},x=new r(y,b);if(t===C)(async()=>{let n;for(n=k(e=>t(o,f,y,a,e)),b.$$obj=!0===(n=k(e=>t(o,u,y,a,e))).isInstant?n.instant:(await n.p).result,n=k(e=>t(o,d,x,a,e)),l&&(g=!0===(n=k(e=>t(o,v,x,a,e))).isInstant?n.instant:(await n.p).result);g;){const s={};n=k(e=>t(o,w,new r(x,s),a,e)),!0===n.isInstant?n.instant:(await n.p).result;const c=await j(o,a,i,[new r(y,s)],"loop");if(c instanceof p&&c.returned)return void e(void 0,c);if(c instanceof p&&c.breakLoop)break;n=k(e=>t(o,h,x,a,e)),g=!0===(n=k(e=>t(o,v,x,a,e))).isInstant?n.instant:(await n.p).result}e()})().catch(e);else{for(O(e=>t(o,f,y,a,e)),b.$$obj=O(e=>t(o,u,y,a,e)).result,O(e=>t(o,d,x,a,e)),l&&(g=O(e=>t(o,v,x,a,e)).result);g;){const n={};O(e=>t(o,w,new r(x,n),a,e));const s=U(o,a,i,[new r(y,n)],"loop");if(s instanceof p&&s.returned)return void e(void 0,s);if(s instanceof p&&s.breakLoop)break;O(e=>t(o,h,x,a,e)),g=O(e=>t(o,v,x,a,e)).result}e()}}),I(86,(t,e,o,n,r,i,a,c,l,d)=>{if("switch"===d&&"continue"===n||!d)throw new s("Illegal "+n+" statement");e(void 0,new p(a.ctx.auditReport,void 0,!1,"break"===n,"continue"===n))}),I(13,(t,e,o,n,r,i,s,a,c,l)=>{t(o,A(n,s)?r.t:r.f,a,s,e,l)}),I(15,(t,e,o,n,r,i,s,a,c,l)=>{t(o,A(n,s)?r.t:r.f,a,s,e,void 0)}),I(16,(t,e,o,n,r)=>e(void 0,new S(n,r))),I(14,(t,e,o,n,r)=>e(void 0,new S(n,r))),I(40,(t,e,o,n,r,i,s,a)=>{t(o,n,a,s,(n,i)=>{if(n)e(n);else if(i=A(i,s),t===$){let n,c=!1;for(const l of r)if(c||(c=!l[1]||i===A(O(e=>t(o,l[1],a,s,e)).result,s))){if(!l[2])continue;if(n=U(o,s,l[2],[a],"switch"),n.breakLoop)break;if(n.returned)return void e(void 0,n);if(!l[1])break}e()}else(async()=>{let n,c=!1;for(const l of r){let r;if(c||(c=!l[1]||i===A(!0===(r=k(e=>t(o,l[1],a,s,e))).isInstant?r.instant:(await r.p).result,s))){if(!l[2])continue;if(n=await j(o,s,l[2],[a],"switch"),n.breakLoop)break;if(n.returned)return void e(void 0,n);if(!l[1])break}}e()})().catch(e)})}),I(39,(t,e,o,n,i,s,a,c,l,p)=>{const[d,u,f]=i;T(t,(n,i)=>{T(t,s=>{s?e(s):n?T(t,e,o,a,u,[new r(c)],p):e(void 0,i)},o,a,f,[new r(c,{})])},o,a,n,[new r(c)],p)}),I(87,(t,e)=>{e()}),I(45,(t,e,o,n,r,i,a)=>{if(!a.ctx.globalsWhitelist.has(n)&&!f.has(n))throw new s(`Object construction not allowed: ${n.constructor.name}`);e(void 0,new n(...r))}),I(46,(t,e,o,n,r)=>{e(r)}),I(43,(t,e,o,n)=>e(void 0,n.pop())),I(0,(t,e)=>e());const W=new Set([11,37,10,38,39,40,14,16,60]);function F(t,e,o,n,r,i,l){const p=i?C:$;if(n.ctx.options.executionQuota&&n.ctx.options.executionQuota<=t.ticks&&("function"!=typeof n.ctx.options.onExecutionQuotaReached||!n.ctx.options.onExecutionQuotaReached(t,o,n,e)))return r(new s("Execution quota exceeded")),!0;if(t.ticks++,e instanceof c)try{r(void 0,e.get(n))}catch(t){r(t)}else if(e===d)r();else if(Array.isArray(e)&&!a(e))0===e[0]?r():R(t,p,e,r,o,n,l);else if(a(e))if(42===e[0])R(t,p,e[1],r,o,n,l);else if(44===e[0])i?n.ctx.prototypeWhitelist?.has(Promise.prototype)?C(t,e[1],o,n,async(t,e)=>{if(t)r(t);else try{r(void 0,await A(e,n))}catch(t){r(t)}},l).catch(r):r(new s("Async/await is not permitted")):r(new s("Illegal use of 'await', must be inside async function"));else{if(!W.has(e[0]))return!1;try{E.get(e[0])?.(p,r,t,e[1],e[2],e,n,o,void 0,l)}catch(t){r(t)}}else r(void 0,e);return!0}function U(t,e,o,n=[],r){return O(i=>T($,i,t,e,o,n,r)).result}async function j(t,e,o,n=[],r){let i;return!0===(i=k(i=>T(C,i,t,e,o,n,r))).isInstant?i.instant:(await i.p).result}function T(t,e,o,n,s,c=[],l){if(!s)return void e();if(!(s instanceof Array))throw new SyntaxError("Bad execution tree");let d,u=n.ctx.globalScope;for(;d=c.shift();)"object"==typeof d&&(u=d instanceof r?d:new r(u,d,d instanceof i?void 0:null));n.ctx.options.audit&&!n.ctx.auditReport&&(n.ctx.auditReport={globalsAccess:new Set,prototypeAccess:{}}),t===$?function(t,e,o,n,r,i){if(!(n instanceof Array))throw new SyntaxError("Bad execution tree");let s=0;for(s=0;s<n.length;s++){let c,l;const d=n[s];try{$(e,d,r,o,(t,e)=>{l=t,c=e},i)}catch(t){l=t}if(l)return void t(l);if(c instanceof p)return void t(void 0,c);if(a(d)&&8===d[0])return void t(void 0,new p(o.ctx.auditReport,c,!0))}t(void 0,new p(o.ctx.auditReport,void 0,!1))}(e,o,n,s,u,l):async function(t,e,o,n,r,i){if(!(n instanceof Array))throw new SyntaxError("Bad execution tree");let s=0;for(s=0;s<n.length;s++){let c,l;const d=n[s];try{await C(e,d,r,o,(t,e)=>{l=t,c=e},i)}catch(t){l=t}if(l)return void t(l);if(c instanceof p)return void t(void 0,c);if(a(d)&&8===d[0])return void t(void 0,new p(o.ctx.auditReport,c,!0))}t(void 0,new p(o.ctx.auditReport,void 0,!1))}(e,o,n,s,u,l).catch(e)}function G(t,e,o,n){if(!(t instanceof Object))throw new Error("Invalid subscription object, got "+("object"==typeof t?"null":typeof t));const r=n.setSubscriptions.get(t)||new Map;n.setSubscriptions.set(t,r);const i=r.get(e)||new Set;let s;r.set(e,i),i.add(o);const a=t[e];return a instanceof Object&&(s=n.changeSubscriptions.get(a)||new Set,s.add(o),n.changeSubscriptions.set(a,s)),{unsubscribe:()=>{i.delete(o),s?.delete(o)}}}BigInt(0);class V{constructor(e,o){this.evalContext=o,this.setSubscriptions=new WeakMap,this.changeSubscriptions=new WeakMap,this.sandboxFunctions=new WeakMap;const n=Object.assign({audit:!1,forbidFunctionCalls:!1,forbidFunctionCreation:!1,globals:V.SAFE_GLOBALS,prototypeWhitelist:V.SAFE_PROTOTYPES,prototypeReplacements:new Map},e||{});this.context=function(e,o){const n=new t(o.globals),i={sandbox:e,globalsWhitelist:new Set(Object.values(o.globals)),prototypeWhitelist:new Map([...o.prototypeWhitelist].map(t=>[t[0].prototype,t[1]])),options:o,globalScope:new r(null,o.globals,n),sandboxGlobal:n};return i.prototypeWhitelist.set(Object.getPrototypeOf([][Symbol.iterator]()),new Set),i}(this,n)}static get SAFE_GLOBALS(){return{globalThis:globalThis,Function:Function,eval:eval,console:{debug:console.debug,error:console.error,info:console.info,log:console.log,table:console.table,warn:console.warn},isFinite:isFinite,isNaN:isNaN,parseFloat:parseFloat,parseInt:parseInt,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,Boolean:Boolean,Number:Number,BigInt:BigInt,String:String,Object:Object,Array:Array,Symbol:Symbol,Error:Error,EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError,Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,Map:Map,Set:Set,WeakMap:WeakMap,WeakSet:WeakSet,Promise:Promise,Intl:Intl,JSON:JSON,Math:Math,Date:Date,RegExp:RegExp}}static get SAFE_PROTOTYPES(){const e=[t,Function,Boolean,Number,BigInt,String,Date,Error,Array,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Map,Set,WeakMap,WeakSet,Promise,Symbol,Date,RegExp],o=new Map;return e.forEach(t=>{o.set(t,new Set)}),o.set(Object,new Set(["constructor","name","entries","fromEntries","getOwnPropertyNames","is","keys","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","values"])),o}subscribeGet(t,e){return e.getSubscriptions.add(t),{unsubscribe:()=>e.getSubscriptions.delete(t)}}subscribeSet(t,e,o,n){return G(t,e,o,n)}subscribeSetGlobal(t,e,o){return G(t,e,o,this)}getContext(t){return this.sandboxFunctions.get(t)}executeTree(t,e=[]){return U({ticks:BigInt(0)},t,t.tree,e)}executeTreeAsync(t,e=[]){return j({ticks:BigInt(0)},t,t.tree,e)}}V.LocalScope=i;export{V as default};
//# sourceMappingURL=SandboxExec.min.js.map
